<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Laporan - MJ98</title>

  <!-- CSS global -->
  <link rel="stylesheet" href="style.css" />

  <!-- Favicon inline agar tidak 404 -->
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" rx="12" fill="%23F5D270"/><text x="50%" y="58%" font-size="34" text-anchor="middle" fill="%23333" font-family="Arial, Helvetica, sans-serif">MJ</text></svg>'>

  <!-- SheetJS untuk export Excel -->
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- Banner global (pengumuman/sisa setoran) — panggil SEKALI di head -->
  <script type="module">
    import('./js/global-alert.js?v=beacon-1').then(m => m.initGlobalAlerts?.());
  </script>
</head>

<body class="page-dashboard">
  <div class="layout">
    <!-- ===== Sidebar ===== -->
    <aside class="sidebar">
      <div class="brand-left">
        <img class="logo"
             src="assets/gold.png"
             alt="MJ98"
             loading="eager"
             decoding="async"
             fetchpriority="high" />
      </div>
      <nav class="menu"></nav>
    </aside>

    <!-- Konten -->
    <main class="content">
      <div class="container">
        <!-- Topbar -->
        <div class="topbar flex items-center justify-between">
          <div class="flex items-center gap-10">
            <img class="logo" alt="MJ98">
            <strong>Laporan</strong>
            <span id="who" class="opacity-80"></span>
          </div>
          <div class="flex items-center gap-8">
            <button id="print"      class="btn">Print</button>
            <button id="export"     class="btn">Export CSV</button>
            <button id="exportXlsx" class="btn">Export Excel</button>
            <button id="logout"     class="btn">Logout</button>
          </div>
        </div>

        <!-- Filter -->
        <section class="card mt-12">
          <form id="filterForm" class="flex items-center gap-10 flex-wrap">
            <div>
              <label for="from">Dari</label>
              <input id="from" name="from" type="date" />
            </div>
            <div>
              <label for="to">Sampai</label>
              <input id="to" name="to" type="date" />
            </div>
            <div>
              <label for="mode">Mode</label>
              <select id="mode" name="mode">
                <option value="per-link">Per Link</option>
                <option value="per-cabang">Per Cabang</option>
                <option value="per-mitra">Per Mitra</option>
              </select>
            </div>
            <div>
              <label for="fltVtype">Voucher</label>
              <select id="fltVtype" name="fltVtype">
                <option value="">Semua</option>
              </select>
            </div>

            <!-- Hierarki -->
            <div id="wrapMitra">
              <label for="fltMitra">Mitra</label>
              <select id="fltMitra" name="fltMitra"></select>
            </div>
            <div id="wrapCabang">
              <label for="fltCabang">Cabang</label>
              <select id="fltCabang" name="fltCabang"></select>
            </div>
            <div id="wrapLink">
              <label for="fltLink">Link</label>
              <select id="fltLink" name="fltLink"></select>
            </div>

            <button id="btnReload" class="btn" type="button">Terapkan</button>
          </form>
        </section>

        <!-- Ringkasan metadata voucher -->
        <section class="cards mt-12">
          <div class="card">
            <div class="fs-12 opacity-70">Jenis Voucher</div>
            <div id="metaVoucher" class="fw-800">Semua</div>
          </div>
          <div class="card">
            <div class="fs-12 opacity-70">Share Link / unit</div>
            <div id="metaShareLink" class="fw-800">-</div>
          </div>
          <div class="card">
            <div class="fs-12 opacity-70">Share Cabang / unit</div>
            <div id="metaShareCabang" class="fw-800">-</div>
          </div>
          <div class="card">
            <div class="fs-12 opacity-70">% Komisi Link</div>
            <div id="metaKomisiLink" class="fw-800">-</div>
          </div>
          <div class="card">
            <div class="fs-12 opacity-70">% Komisi Cabang</div>
            <div id="metaKomisiCabang" class="fw-800">-</div>
          </div>
          <div class="card">
            <div class="fs-12 opacity-70">% Komisi Mitra</div>
            <div id="metaKomisiMitra" class="fw-800">-</div>
          </div>
        </section>

        <!-- Ringkasan angka -->
        <section id="summary" class="cards mt-12">
          <div class="card">
            <div class="fs-12 opacity-70">Total Tagihan</div>
            <div id="sumTagihan" class="fw-800" style="font-size:24px">Rp 0</div>
          </div>
          <div class="card">
            <div class="fs-12 opacity-70">Total Setoran</div>
            <div id="sumSetoran" class="fw-800" style="font-size:24px">Rp 0</div>
          </div>
          <div class="card">
            <div class="fs-12 opacity-70">Sisa Setoran</div>
            <div id="sumSisa" class="fw-800" style="font-size:24px">Rp 0</div>
          </div>
          <div class="card">
            <div class="fs-12 opacity-70">Voucher Terjual</div>
            <div id="sumTrx" class="fw-800" style="font-size:24px">0</div>
          </div>

          <div class="card">
            <div class="fs-12 opacity-70">Pendapatan Link</div>
            <div id="sumPendLink" class="fw-800">Rp 0</div>
          </div>
          <div class="card">
            <div class="fs-12 opacity-70">Pendapatan Cabang</div>
            <div id="sumPendCabang" class="fw-800">Rp 0</div>
          </div>
          <div class="card">
            <div class="fs-12 opacity-70">Pendapatan Mitra</div>
            <div id="sumPendMitra" class="fw-800">Rp 0</div>
          </div>
          <div class="card">
            <div class="fs-12 opacity-70">Pendapatan Owner</div>
            <div id="sumPendOwner" class="fw-800">Rp 0</div>
          </div>
        </section>

        <!-- Tabel -->
        <section class="card mt-12 overflow-auto" id="tableWrap">
          <table id="tbl" style="width:100%;border-collapse:collapse">
            <thead id="tbl-head"></thead>
            <tbody id="tbl-body"></tbody>
          </table>
        </section>
      </div>
    </main>
  </div>

  <!-- Script global sidebar (render menu untuk semua halaman) -->
  <script type="module" src="js/sidebar.js?v=deploy-01"></script>

  <!-- Script khusus halaman ini -->
  <script type="module" src="js/laporan.js"></script>
</body>
</html>

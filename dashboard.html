<!-- dashboard.html — MJ98 (role-aware + KPI via RPC deposits) -->
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard – MJ98</title>

  <link rel="stylesheet" href="style.css" />
  <!-- Favicon inline agar tidak 404 -->
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" rx="12" fill="%23FFDE59"/><text x="50%" y="58%" font-size="34" text-anchor="middle" fill="%230F172A" font-family="Arial, Helvetica, sans-serif">MJ</text></svg>' />

  <!-- Tambahan style kecil untuk judul & efek teks -->
  <style>
    /* logo biru di kiri judul */
    .title-row{display:flex;align-items:center;gap:12px;margin:8px 0 0}
    .title-row .title-logo{width:44px;height:44px;object-fit:contain;display:inline-block} /* diperbesar */
    .title-row h1{margin:0}

    /* Efek “emas kebiruan” bergerak untuk teks Selamat datang */
    .welcome-bling{
      background-image: linear-gradient(90deg,#f6c70b 0%,#1e90ff 50%,#f6c70b 100%);
      background-size: 200% auto;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: shimmer 4s linear infinite;
      letter-spacing: .2px;
    }
    @keyframes shimmer{
      0%{background-position: 0% 50%}
      100%{background-position: 200% 50%}
    }
  </style>
</head>

<script type="module">
  import('./js/global-alert.js?v=deploy-01').then(m => m.initGlobalAlerts?.());
</script>

<body class="page-dashboard">
  <div class="layout">
    <!-- ===== Sidebar kiri (konsisten) ===== -->
    <aside class="sidebar">
      <!-- Logo sidebar: gold.png -->
      <img class="logo" src="assets/gold.png" alt="MJ98" />
      <nav class="menu">
        <a class="btn active" href="dashboard.html" aria-current="page">Dashboard</a>
        <a class="btn" href="laporan.html">Laporan</a>
        <a class="btn" href="setoran.html">Setoran</a>
        <a class="btn" href="stok.html">Stok</a>
        <a class="btn" href="voucher.html">Voucher</a>
        <a class="btn" href="pengumuman.html">Pengumuman</a>
        <a class="btn" href="pengaturan.html">Pengaturan</a>
      </nav>
    </aside>

    <!-- ===== Konten kanan ===== -->
    <main class="content">
      <div class="container">
        <!-- Topbar: ucapan + role + logout + periode -->
        <div class="topbar" style="gap:12px;flex-wrap:wrap">
          <div class="flex items-center gap-10">
            <!-- efek gradien bergerak diterapkan di sini -->
            <div id="greet" class="fw-700 welcome-bling">Memuat…</div>
            <span id="roleBadge" class="pill">-</span>
          </div>
          <div class="flex items-center gap-8" style="margin-left:auto">
            <label class="fs-12 opacity-70">Dari
              <input id="from" type="date" />
            </label>
            <label class="fs-12 opacity-70">Sampai
              <input id="to" type="date" />
            </label>
            <small id="kpiPeriode" class="opacity-70"></small>
            <button id="btnLogout" class="btn">Logout</button>
          </div>
        </div>

        <!-- Judul halaman: logo biru di kiri, lalu teks Dashboard, lalu ikon -->
        <div class="title-row">
          <img src="assets/blue.webp" alt="MJ98" class="title-logo" />
          <h1>Dashboard <span aria-hidden="true">📊</span></h1>
        </div>

        <!-- Kartu identitas -->
        <div class="cards mt-12">
          <div class="card">
            <div class="fs-12 opacity-70">Pengguna</div>
            <div id="whoami" class="fw-800 fs-20">-</div>
            <div id="welcomeLine" class="fs-12 opacity-70">Selamat datang di MJ98</div>
          </div>
        </div>

        <!-- KPI utama (Tagihan/Disetor/Sisa) via RPC summary_tagihan_deposits -->
        <section class="cards mt-12" id="kpiCards">
          <div class="card">
            <div class="fs-12 opacity-70">Tagihan Owner (periode)</div>
            <div id="kpiTagihanOwner" class="fw-800" style="font-size:22px">Rp 0</div>
          </div>
          <div class="card">
            <div class="fs-12 opacity-70">Total Disetor (periode)</div>
            <div id="kpiTotalSetor" class="fw-800" style="font-size:22px">Rp 0</div>
          </div>
          <div class="card">
            <div class="fs-12 opacity-70">Sisa Setoran (periode)</div>
            <div id="kpiSisaSetor" class="fw-800" style="font-size:22px">Rp 0</div>
          </div>
        </section>

        <!-- Kartu metrik lain (voucher terjual, pendapatan per-role, counts) -->
        <div class="cards mt-12" id="metricCards"></div>

        <!-- Catatan -->
        <div class="card mt-16">
          <h3 class="mb-8">Ringkasan Singkat</h3>
          <p id="hintText" class="fs-14 opacity-80 mb-0">
            Angka mengikuti hirarki akun yang login. Ubah tanggal untuk mengatur periode KPI &amp; laporan ringkas.
          </p>
        </div>
      </div>
    </main>
  </div>

  <!-- Logika halaman -->
  <script type="module" src="js/dashboard.js"></script>
</body>

<!-- Muat sekali; file akan auto-init sendiri -->
<script type="module" src="./js/global-alert.js?v=beacon-1"></script>
</html>
